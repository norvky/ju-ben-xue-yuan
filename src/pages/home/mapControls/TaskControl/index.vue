<template>
  <div ref="controlContainer" class="maplibregl-ctrl" @click="onClick">
    <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
      <!-- <path
        d="M317.357 159.109c17.216-64.238 261.174 7.45 288.751 77.39 62.755 159.155 324.818 87.067 324.85 87.06L805.234 792.867s-262.088 72.108-324.85-87.059c-21.12-53.553-168.828-107.903-244.74-101.691l-69.727 260.26c-5.339 19.936-25.823 31.77-45.762 26.43-19.931-5.346-31.76-25.839-26.418-45.774L277.492 159.11c5.339-19.935 25.827-31.769 45.766-26.422 0.387 0.103 0.658 0.4 1.041 0.519"
        fill="currentColor"
      ></path> -->
      <path
        d="M1014.247619 594.895238c-19.504762-39.009524-48.761905-58.514286-82.895238-68.266667h-9.752381l-53.638095 29.257143c-39.009524-53.638095-68.266667-151.161905-97.52381-243.809524-48.761905-146.285714-87.771429-268.190476-160.914285-287.695238h-9.752381c-151.161905 39.009524-326.704762 97.52381-531.504762 170.666667-4.87619 0-9.752381 0-9.752381 4.876191-9.752381 4.87619-19.504762 14.628571-24.380953 29.257142-9.752381 19.504762-19.504762 68.266667 24.380953 151.161905l9.752381 19.504762 19.504762-4.87619c19.504762-4.87619 48.761905-19.504762 82.895238-34.133334 29.257143 78.019048 58.514286 175.542857 82.895238 263.314286 43.885714 151.161905 82.895238 292.571429 126.780952 355.961905 24.380952 29.257143 53.638095 43.885714 87.771429 43.885714 14.628571 0 34.133333-4.87619 48.761904-9.752381 9.752381-4.87619 19.504762-9.752381 24.380953-19.504762h4.87619l458.361905-263.314286 4.876191-4.87619c24.380952-48.761905 24.380952-92.647619 4.87619-131.657143zM92.647619 341.333333c-19.504762-48.761905-24.380952-78.019048-14.628571-92.647619 0-4.87619 0-4.87619 4.87619-9.752381h19.504762c14.628571 4.87619 34.133333 34.133333 53.638095 78.019048-24.380952 9.752381-48.761905 19.504762-63.390476 24.380952z m404.72381 624.152381c-29.257143 14.628571-58.514286 9.752381-78.019048-14.628571-39.009524-53.638095-78.019048-199.92381-117.028571-336.457143-58.514286-204.8-97.52381-341.333333-151.161905-394.971429 170.666667-58.514286 321.828571-107.27619 448.609524-141.409523 43.885714 19.504762 87.771429 146.285714 121.904761 253.561904 29.257143 92.647619 63.390476 190.171429 102.4 248.685715l-394.971428 190.171428h-4.876191-4.87619c-34.133333 34.133333-29.257143 87.771429 9.752381 156.038095l9.752381 29.257143 19.504762-14.628571c4.87619-4.87619 24.380952-14.628571 58.514285-29.257143v29.257143c-4.87619 14.628571-14.628571 24.380952-19.504761 24.380952z m-53.638096-146.285714c19.504762 9.752381 39.009524 24.380952 53.638096 43.885714-14.628571 9.752381-29.257143 14.628571-39.009524 19.504762-9.752381-19.504762-19.504762-43.885714-14.628572-63.390476z m526.628572-126.780952l-399.847619 229.180952c0-14.628571-4.87619-34.133333-14.628572-53.638095-14.628571-29.257143-39.009524-53.638095-63.390476-73.142857l438.857143-214.552381c19.504762 4.87619 34.133333 19.504762 43.885714 39.009523 9.752381 19.504762 4.87619 43.885714-4.87619 73.142858z"
        fill="currentColor"
      ></path>
      <path
        d="M526.628571 672.914286c4.87619 0 14.628571-4.87619 19.504762-9.752381 9.752381-9.752381 9.752381-24.380952 0-34.133334-34.133333-29.257143-63.390476-92.647619-92.647619-180.419047l97.52381 34.133333 53.638095-117.028571c4.87619-14.628571 0-24.380952-14.628571-34.133334-14.628571-4.87619-24.380952 0-34.133334 14.628572l-34.133333 78.019047-87.771429-29.257142h-4.87619c-4.87619-24.380952-9.752381-43.885714-14.628572-68.266667l97.52381 29.257143 34.133333-87.771429c4.87619-14.628571 0-24.380952-14.628571-34.133333-14.628571-4.87619-24.380952 0-34.133333 14.628571l-19.504762 48.761905-131.657143-39.009524 9.752381 39.009524c43.885714 195.047619 97.52381 316.952381 151.161905 370.590476 4.87619 0 9.752381 4.87619 19.504761 4.876191z"
        fill="currentColor"
      ></path>
    </svg>
  </div>

  <view
    :style="{
      position: 'absolute',
      left: '0',
      top: '0',
      right: '0',
      bottom: '0',
      opacity: showScreenplay ? 1 : 0,
      transform: showScreenplay ? 'scale(1)' : 'scale(0)',
      transformOrigin: 'calc(100% - 34px) 34px',
      transition: 'all 0.3s',
      zIndex: showScreenplay ? 99 : -1,
    }"
  >
    <wd-button
      class="!absolute right-2 top-2 z-1 !bg-#7F776D !text-#3C1E1C"
      type="icon"
      icon="close"
      @click="showScreenplay = false"
    />

    <Screenplay />
  </view>
</template>

<script setup name="TaskControl">
import { ref } from 'vue'
import Screenplay from '@/pages/screenplay/screenplay.vue'

const controlContainer = ref(null)
const showScreenplay = ref(false)

function onClick() {
  showScreenplay.value = !showScreenplay.value
}

// 控件的 onAdd 方法
const onAdd = () => {
  return controlContainer.value
}

// 控件的 onRemove 方法
const onRemove = () => {
  if (controlContainer.value?.parentNode) {
    controlContainer.value.parentNode.removeChild(controlContainer.value)
  }
}

// 暴露 init 方法
const init = (map, position = 'top-right') => {
  if (map) {
    map.addControl({ onAdd, onRemove }, position)
    console.log('地图控件初始化完成: TaskControl')
  } else {
    console.warn('地图对象不存在')
  }
}

// 暴露 init 方法给父组件
defineExpose({ init })
</script>

<style scoped>
.maplibregl-ctrl {
  display: flex;
  width: 40px;
  height: 40px;
  padding: 4px;
  color: #4d80f0;
  cursor: pointer;
  background-color: rgba(255, 255, 255, 0.5);
  backdrop-filter: blur(4px);
  border-radius: 50%;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
  transition: all 0.1s linear;
}
.maplibregl-ctrl:active {
  transform: scale(0.9);
}
svg {
  transform: scale(0.8);
}
</style>
